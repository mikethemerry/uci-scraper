import scrapy
import urllib

import os, io

class DatasetSpider(scrapy.Spider):
    name = "dataset"

    def start_requests(self):
        urls = ["../machine-learning-databases/abalone/", "../machine-learning-databases/breast-cancer/", "../machine-learning-databases/bridges/", "../machine-learning-databases/balloons/", "../machine-learning-databases/car/", "../machine-learning-databases/chess/king-rook-vs-king-knight/", "../machine-learning-databases/breast-cancer-wisconsin/", "../machine-learning-databases/breast-cancer-wisconsin/", "../machine-learning-databases/adult/", "../machine-learning-databases/breast-cancer-wisconsin/", "../machine-learning-databases/badges/", "../machine-learning-databases/balance-scale/", "../machine-learning-databases/autos/", "../machine-learning-databases/auto-mpg/", "../machine-learning-databases/audiology/", "../machine-learning-databases/00505/", "../machine-learning-databases/audiology/", "../machine-learning-databases/00279/", "../machine-learning-databases/00506/", "../machine-learning-databases/00507/", "../machine-learning-databases/00504/", "../machine-learning-databases/00503/", "../machine-learning-databases/00502/", "../machine-learning-databases/00500/", "../machine-learning-databases/00499/", "../machine-learning-databases/00498/", "../machine-learning-databases/00497/", "../machine-learning-databases/00501/", "../machine-learning-databases/00496/", "../machine-learning-databases/00494/", "../machine-learning-databases/00495/", "../machine-learning-databases/00493/", "../machine-learning-databases/00492/", "../machine-learning-databases/00489/", "../machine-learning-databases/00488/", "../machine-learning-databases/00487/", "../machine-learning-databases/00486/", "../machine-learning-databases/00485/", "../machine-learning-databases/00482/", "../machine-learning-databases/00481/", "../machine-learning-databases/00479/", "../machine-learning-databases/00484/", "../machine-learning-databases/00483/", "../machine-learning-databases/00480/", "../machine-learning-databases/00477/", "../machine-learning-databases/00472/", "../machine-learning-databases/00471/", "../machine-learning-databases/00476/", "../machine-learning-databases/00475/", "../machine-learning-databases/00474/", "../machine-learning-databases/00470/", "../machine-learning-databases/00473/", "../machine-learning-databases/00467/", "../machine-learning-databases/00469/", "../machine-learning-databases/00468/", "../machine-learning-databases/00466/", "../machine-learning-databases/00465/", "../machine-learning-databases/00464/", "../machine-learning-databases/00463/", "../machine-learning-databases/00462/", "../machine-learning-databases/00459/", "../machine-learning-databases/00461/", "../machine-learning-databases/00460/", "../machine-learning-databases/00458/", "../machine-learning-databases/00457/", "../machine-learning-databases/00456/", "../machine-learning-databases/00455/", "../machine-learning-databases/00454/", "../machine-learning-databases/00451/", "../machine-learning-databases/00453/", "../machine-learning-databases/00452/", "../machine-learning-databases/00450/", "../machine-learning-databases/00449/", "../machine-learning-databases/00448/", "../machine-learning-databases/00447/", "../machine-learning-databases/00446/", "../machine-learning-databases/00437/", "../machine-learning-databases/00442/", "../machine-learning-databases/00441/", "../machine-learning-databases/00445/", "../machine-learning-databases/00440/", "../machine-learning-databases/00439/", "../machine-learning-databases/00438/", "../machine-learning-databases/00436/", "../machine-learning-databases/00434/", "../machine-learning-databases/00432/", "../machine-learning-databases/00430/", "../machine-learning-databases/00433/", "../machine-learning-databases/00431/", "../machine-learning-databases/00429/", "../machine-learning-databases/00435/", "../machine-learning-databases/00428/", "../machine-learning-databases/00427/", "../machine-learning-databases/00424/", "../machine-learning-databases/00426/", "../machine-learning-databases/00423/", "../machine-learning-databases/00425/", "../machine-learning-databases/00422/", "../machine-learning-databases/00421/", "../machine-learning-databases/00420/", "../machine-learning-databases/00419/", "../machine-learning-databases/00417/", "../machine-learning-databases/00416/", "../machine-learning-databases/00415/", "../machine-learning-databases/00413/", "../machine-learning-databases/00418/", "../machine-learning-databases/00414/", "../machine-learning-databases/00412/", "../machine-learning-databases/00409/", "../machine-learning-databases/00411/", "../machine-learning-databases/00406/", "../machine-learning-databases/00410/", "../machine-learning-databases/00408/", "../machine-learning-databases/00405/", "../machine-learning-databases/00407/", "../machine-learning-databases/00404/", "../machine-learning-databases/00397/", "../machine-learning-databases/00396/", "../machine-learning-databases/00402/", "../machine-learning-databases/00401/", "../machine-learning-databases/00400/", "../machine-learning-databases/00399/", "../machine-learning-databases/00398/", "../machine-learning-databases/00394/", "../machine-learning-databases/00391/", "../machine-learning-databases/00390/", "../machine-learning-databases/00395/", "../machine-learning-databases/00389/", "../machine-learning-databases/00388/", "../machine-learning-databases/00393/", "../machine-learning-databases/00360/", "../machine-learning-databases/00385/", "../machine-learning-databases/00383/", "../machine-learning-databases/00381/", "../machine-learning-databases/00386/", "../machine-learning-databases/00380/", "../machine-learning-databases/00384/", "../machine-learning-databases/00382/", "../machine-learning-databases/00379/", "../machine-learning-databases/00375/", "../machine-learning-databases/00378/", "../machine-learning-databases/00373/", "../machine-learning-databases/00377/", "../machine-learning-databases/00372/", "../machine-learning-databases/00376/", "../machine-learning-databases/00374/", "../machine-learning-databases/00367/", "../machine-learning-databases/00371/", "../machine-learning-databases/00368/", "../machine-learning-databases/00366/", "../machine-learning-databases/00365/", "../machine-learning-databases/00364/", "../machine-learning-databases/00369/", "../machine-learning-databases/00363/", "../machine-learning-databases/00361/", "../machine-learning-databases/00360/", "../machine-learning-databases/00362/", "../machine-learning-databases/00359/", "../machine-learning-databases/00357/", "../machine-learning-databases/00355/", "../machine-learning-databases/00354/", "../machine-learning-databases/00352/", "../machine-learning-databases/00353/", "../machine-learning-databases/00350/", "../machine-learning-databases/00349/", "../machine-learning-databases/00348/", "../machine-learning-databases/00347/", "../machine-learning-databases/00346/", "../machine-learning-databases/00340/", "../machine-learning-databases/00342/", "../machine-learning-databases/00344/", "../machine-learning-databases/00343/", "../machine-learning-databases/00341/", "../machine-learning-databases/00339/", "../machine-learning-databases/00338/", "../machine-learning-databases/00337/", "../machine-learning-databases/00336/", "../machine-learning-databases/00335/", "../machine-learning-databases/00334/", "../machine-learning-databases/00333/", "../machine-learning-databases/00332/", "../machine-learning-databases/00331/", "../machine-learning-databases/00330/", "../machine-learning-databases/00329/", "../machine-learning-databases/00321/", "../machine-learning-databases/00326/", "../machine-learning-databases/00325/", "../machine-learning-databases/00324/", "../machine-learning-databases/00328/", "../machine-learning-databases/00327/", "../machine-learning-databases/00323/", "../machine-learning-databases/00322/", "../machine-learning-databases/00314/", "../machine-learning-databases/00319/", "../machine-learning-databases/00318/", "../machine-learning-databases/00317/", "../machine-learning-databases/00316/", "../machine-learning-databases/00315/", "../machine-learning-databases/00313/", "../machine-learning-databases/00320/", "../machine-learning-databases/00311/", "../machine-learning-databases/00310/", "../machine-learning-databases/00309/", "../machine-learning-databases/00308/", "../machine-learning-databases/00307/", "../machine-learning-databases/00312/", "../machine-learning-databases/00306/", "../machine-learning-databases/00305/", "../machine-learning-databases/00304/", "../machine-learning-databases/00303/", "../machine-learning-databases/00302/", "../machine-learning-databases/00301/", "../machine-learning-databases/00300/", "../machine-learning-databases/00299/", "../machine-learning-databases/00298/", "../machine-learning-databases/00296/", "../machine-learning-databases/00295/", "../machine-learning-databases/00292/", "../machine-learning-databases/00294/", "../machine-learning-databases/00293/", "../machine-learning-databases/00291/", "../machine-learning-databases/00290/", "../machine-learning-databases/00289/", "../machine-learning-databases/00288/", "../machine-learning-databases/00286/", "../machine-learning-databases/00287/", "../machine-learning-databases/00285/", "../machine-learning-databases/00283/", "../machine-learning-databases/00282/", "../machine-learning-databases/00281/", "../machine-learning-databases/00280/", "../machine-learning-databases/00278/", "../machine-learning-databases/00277/", "../machine-learning-databases/00276/", "../machine-learning-databases/00275/", "../machine-learning-databases/00274/", "../machine-learning-databases/00273/", "../machine-learning-databases/00272/", "../machine-learning-databases/00271/", "../machine-learning-databases/00270/", "../machine-learning-databases/00268/", "../machine-learning-databases/00267/", "../machine-learning-databases/00269/", "../machine-learning-databases/00264/", "../machine-learning-databases/00266/", "../machine-learning-databases/00265/", "../machine-learning-databases/00263/", "../machine-learning-databases/00262/", "../machine-learning-databases/00257/", "../machine-learning-databases/00260/", "../machine-learning-databases/00259/", "../machine-learning-databases/00255/", "../machine-learning-databases/00254/", "../machine-learning-databases/00256/", "../machine-learning-databases/00253/", "../machine-learning-databases/00252/", "../machine-learning-databases/00250/", "../machine-learning-databases/00249/", "../machine-learning-databases/00248/", "../machine-learning-databases/00251/", "../machine-learning-databases/00247/", "../machine-learning-databases/00246/", "../machine-learning-databases/00245/", "../machine-learning-databases/00244/", "../machine-learning-databases/00238/", "../machine-learning-databases/00243/", "../machine-learning-databases/00242/", "../machine-learning-databases/00241/", "../machine-learning-databases/00240/", "../machine-learning-databases/00239/", "../machine-learning-databases/00237/", "../machine-learning-databases/00236/", "../machine-learning-databases/00227/", "../machine-learning-databases/00233/", "../machine-learning-databases/00232/", "../machine-learning-databases/00231/", "../machine-learning-databases/00230/", "../machine-learning-databases/00229/", "../machine-learning-databases/00235/", "../machine-learning-databases/00228/", "../machine-learning-databases/00219/", "../machine-learning-databases/00225/", "../machine-learning-databases/00224/", "../machine-learning-databases/00223/", "../machine-learning-databases/00222/", "../machine-learning-databases/00221/", "../machine-learning-databases/00220/", "../machine-learning-databases/00226/", "../machine-learning-databases/00218/", "../machine-learning-databases/00217/", "../machine-learning-databases/00216/", "../machine-learning-databases/00215/", "../machine-learning-databases/00214/", "../machine-learning-databases/00213/", "../machine-learning-databases/00212/", "../machine-learning-databases/00211/", "../machine-learning-databases/00199/", "../machine-learning-databases/00209/", "../machine-learning-databases/00208/", "../machine-learning-databases/00206/", "../machine-learning-databases/00205/", "../machine-learning-databases/00204/", "../machine-learning-databases/00203/", "../machine-learning-databases/00210/", "../machine-learning-databases/00198/", "../machine-learning-databases/00197/", "../machine-learning-databases/00196/", "../machine-learning-databases/00195/", "../machine-learning-databases/00194/", "../machine-learning-databases/00193/", "../machine-learning-databases/00192/", "../machine-learning-databases/opinion/", "../machine-learning-databases/parkinsons/telemonitoring/", "../machine-learning-databases/p53/", "../machine-learning-databases/url/", "../machine-learning-databases/wine-quality/", "../machine-learning-databases/acute/", "../machine-learning-databases/communities/", "../machine-learning-databases/concrete/slump/", "../machine-learning-databases/demospongiae", "../machine-learning-databases/plants/", "../machine-learning-databases/libras/", "../machine-learning-databases/secom/", "../machine-learning-databases/semeion/", "../machine-learning-databases/uji-penchars/version2/", "../machine-learning-databases/blood-transfusion/", "../machine-learning-databases/character-trajectories/", "../machine-learning-databases/parkinsons/", "../machine-learning-databases/abscisic-acid/", "../machine-learning-databases/ozone/", "../machine-learning-databases/madelon/", "../machine-learning-databases/gisette/", "../machine-learning-databases/dexter/", "../machine-learning-databases/arcene/", "../machine-learning-databases/hill-valley/", "../machine-learning-databases/dorothea/", "../machine-learning-databases/bag-of-words/", "../machine-learning-databases/concrete/compressive/", "../machine-learning-databases/mammographic-masses/", "../machine-learning-databases/reuters_transcribed/reuters_transcribed.html-mld/", "../machine-learning-databases/forest-fires/", "../machine-learning-databases/uji-penchars/version1/", "../machine-learning-databases/magic/", "../machine-learning-databases/undocumented/taylor/", "../machine-learning-databases/undocumented/sigillito/", "../machine-learning-databases/undocumented/pazzani/", "../machine-learning-databases/undocumented/connectionist-bench/vowel/", "../machine-learning-databases/undocumented/connectionist-bench/sonar/", "../machine-learning-databases/statlog/shuttle/", "../machine-learning-databases/undocumented/connectionist-bench/nettalk/", "../machine-learning-databases/statlog/segment/", "../machine-learning-databases/statlog/vehicle/", "../machine-learning-databases/statlog/satimage/", "../machine-learning-databases/poker/", "../machine-learning-databases/statlog/heart/", "../machine-learning-databases/statlog/german/", "../machine-learning-databases/volcanoes-mld/", "../machine-learning-databases/SyskillWebert-mld/", "../machine-learning-databases/statlog/australian/", "../machine-learning-databases/UNIX_user_data-mld/", "../machine-learning-databases/event-detection/", "../machine-learning-databases/event-detection/", "../machine-learning-databases/synthetic_control-mld/", "../machine-learning-databases/reuters21578-mld/", "../machine-learning-databases/synthetic-mld/", "../machine-learning-databases/robotfailure-mld/", "../machine-learning-databases/pioneer-mld/", "../machine-learning-databases/nsfabs-mld/", "../machine-learning-databases/msnbc-mld/", "../machine-learning-databases/movies-mld/", "../machine-learning-databases/kddcup99-mld/", "../machine-learning-databases/tb-mld/", "../machine-learning-databases/kddcup98-mld/", "../machine-learning-databases/JapaneseVowels-mld/", "../machine-learning-databases/ipums-mld/", "../machine-learning-databases/internet_usage-mld/", "../machine-learning-databases/tic-mld/", "../machine-learning-databases/faces-mld/", "../machine-learning-databases/entree-mld/", "../machine-learning-databases/census-income-mld/", "../machine-learning-databases/el_nino-mld/", "../machine-learning-databases/eeg-mld/", "../machine-learning-databases/ecoli-mld/", "../machine-learning-databases/CorelFeatures-mld/", "../machine-learning-databases/coil-mld/", "../machine-learning-databases/census1990-mld/", "../machine-learning-databases/20newsgroups-mld/", "../machine-learning-databases/yeast/", "../machine-learning-databases/undocumented/", "../machine-learning-databases/waveform/", "../machine-learning-databases/auslan-mld/", "../machine-learning-databases/wine/", "../machine-learning-databases/zoo/", "../machine-learning-databases/auslan2-mld/", "../machine-learning-databases/water-treatment/", "../machine-learning-databases/waveform/", "../machine-learning-databases/thyroid-disease/", "../machine-learning-databases/voting-records/", "../machine-learning-databases/tae/", "../machine-learning-databases/student-loan/", "../machine-learning-databases/trains/", "../machine-learning-databases/tic-tac-toe/", "../machine-learning-databases/sponge/", "../machine-learning-databases/spambase/", "../machine-learning-databases/space-shuttle/", "../machine-learning-databases/spect/", "../machine-learning-databases/university/", "../machine-learning-databases/spectrometer/", "../machine-learning-databases/spect/", "../machine-learning-databases/solar-flare/", "../machine-learning-databases/soybean/", "../machine-learning-databases/soybean/", "../machine-learning-databases/statlog/", "../machine-learning-databases/shuttle-landing-control/", "../machine-learning-databases/qsar/", "../machine-learning-databases/quadrapeds/", "http://www.ics.uci.edu/~mlearn/databases/prodigy/", "../machine-learning-databases/primary-tumor/", "../machine-learning-databases/postoperative-patient-data/", "../machine-learning-databases/servo/", "../machine-learning-databases/page-blocks/", "../machine-learning-databases/othello/", "../machine-learning-databases/musk/", "../machine-learning-databases/pendigits/", "../machine-learning-databases/musk/", "../machine-learning-databases/optdigits/", "../machine-learning-databases/nursery/", "../machine-learning-databases/moral-reasoner/", "../machine-learning-databases/monks-problems/", "../machine-learning-databases/molecular-biology/protein-secondary-structure/", "../machine-learning-databases/mobile-robots/", "../machine-learning-databases/mfeat/", "../machine-learning-databases/mechanical-analysis/", "../machine-learning-databases/meta-data/", "../machine-learning-databases/molecular-biology/splice-junction-gene-sequences/", "../machine-learning-databases/lymphography/", "../machine-learning-databases/mushroom/", "../machine-learning-databases/logic-theorist/", "../machine-learning-databases/lenses/", "../machine-learning-databases/liver-disorders/", "../machine-learning-databases/led-display-creator/", "../machine-learning-databases/lung-cancer/", "../machine-learning-databases/kinship/", "../machine-learning-databases/molecular-biology/promoter-gene-sequences/", "../machine-learning-databases/letter-recognition/", "../machine-learning-databases/labor-negotiations/", "../machine-learning-databases/isolet/", "../machine-learning-databases/ionosphere/", "../machine-learning-databases/internet_ads/", "../machine-learning-databases/icu/", "../machine-learning-databases/hayes-roth/", "../machine-learning-databases/hepatitis/", "../machine-learning-databases/horse-colic/", "../machine-learning-databases/image/", "../machine-learning-databases/heart-disease/", "../machine-learning-databases/haberman/", "../machine-learning-databases/function-finding/", "../machine-learning-databases/iris/", "../machine-learning-databases/glass/", "../machine-learning-databases/ebl/", "../machine-learning-databases/flags/", "../machine-learning-databases/document-understanding", "../machine-learning-databases/dgp-2/", "../machine-learning-databases/diabetes/", "../machine-learning-databases/ecoli/", "../machine-learning-databases/echocardiogram/", "../machine-learning-databases/cmc/", "../machine-learning-databases/covtype/", "../machine-learning-databases/cylinder-bands/", "../machine-learning-databases/cpu-performance/", "../machine-learning-databases/dermatology/", "../machine-learning-databases/connect-4/", "../machine-learning-databases/credit-screening", "../machine-learning-databases/credit-screening/", "../machine-learning-databases/chess/domain-theories/", "../machine-learning-databases/chess/king-rook-vs-king-pawn/", "../machine-learning-databases/artificial-characters/", "../machine-learning-databases/anonymous/", "../machine-learning-databases/annealing/", "../machine-learning-databases/chorales", "../machine-learning-databases/chess/king-rook-vs-king/", "../machine-learning-databases/arrhythmia/", "../machine-learning-databases/adult/"]

        for url in urls:
            cleanUrl = urllib.parse.urljoin('https://archive.ics.uci.edu/ml/base/', url)
            yield scrapy.Request(url=cleanUrl, callback=self.parse_directory)

    def parse_directory(self, response):
        for nLink, link in enumerate(response.css('a::attr(href)')):
            if nLink > 1:
                href = link.get()
                yield scrapy.Request(
                    url=response.urljoin(href),
                    callback=self.save_file
                )
    def save_file(self, response):
        urlParts = response.url.split('/')
        savePath = './data/%s' % (urlParts[-2])
        if not os.path.exists(savePath):
            os.makedirs(savePath)
        with open(os.path.join(savePath, urlParts[-1]), 'wb') as f:
            f.write(response.body)